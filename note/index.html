<html>
  <head>
    <title>Note</title>
    <style>
      :root {
        --std-size: large;
      }
      html {
        height: 100%;
      }
      body {
        background: rgb(237, 237, 192);
        padding: 0;
        margin: 0;
        font-family: monospace;
        font-size: 20px;
        height: 100%;
      }
      a {
        color: rgb(126, 139, 160);
        font-size: var(--std-size);
      }
      a:hover {
        color: rgb(144, 42, 42);
        font-size: var(--std-size);
      }
      a:visited {
        color: rgb(182, 194, 242);
        font-size: var(--std-size);
      }
      button {
        background: rgb(182, 194, 242);
        width: 100px;
        height: 30px;
        float: left;
        margin-right: 10px;
        font-size: 18px;
        border-radius: 10px;
        border: none;
      }
      .top,
      .bottom {
        width: 840px;
        max-width: 100%;
        margin: auto;
        display: block;
      }
      .top {
        height: 100px;
        padding-top: 40px;
        display: fixed;
      }
      input,
      input:focus,
      .bottom,
      .bottom:active,
      .bottom:focus {
        min-height: calc(100% - 200px);
        display: block;
        border: 1px solid rgb(126, 139, 160);
      }
      .help {
        color: rgb(126, 139, 160);
        font-size: var(--std-size);
        display: block;
      }
      .showmult {
        display: none;
      }
      .version {
        display: none;
      }
    </style>
  </head>
  <body onload="execOnLoad();">
    <div class="top">
      <a href="https://unforswearing.com">unforswearing.com</a>/<a
        href="https://unforswearing.com/note"
        >note</a
      >
      <br /><br />
      <button onclick="loadNewFile()">new</button>
      <button onclick="saveToLocalStorage()">save</button>
      <button onclick="deleteCurrentFile()">delete</button>
      <button class="showmult" id="showmult" onclick="clearLocalStorage()">
        remove all
      </button>
      <br /><br />
      <span class="help" id="help"></span>
      <br />
    </div>
    <div
      id="content"
      class="bottom"
      placeholder="content"
      contenteditable
    ></div>
    <span class="version">0.1.11</span>
    <script>
      const action = {
        get() {
          return localStorage["action"];
        },
        load() {
          localStorage.setItem("action", "load");
        },
        new() {
          localStorage.setItem("action", "new");
        },
        save() {
          localStorage.setItem("action", "save");
        },
        delete() {
          localStorage.setItem("action", "delete");
        },
        removeAll() {
          localStorage.setItem("action", "removeAll");
        },
        loadFile() {
          localStorage.setItem("action", "loadFile");
        },
        loadFileByUrl() {
          localStorage.setItem("action", "loadFileByUrl");
        },
      };
      function errorMessage(message) {
        return `<span style="color: rgb(144, 42, 42);">
              ${message}
            </span>`;
      }
      function execOnLoad() {
        loadFileByUrl();
        if (localStorage.length > 2) {
          document.getElementById("showmult").style.display = "block";
        }
      }
      function setHelpMessage(message) {
        localStorage.setItem("msg", message);
      }
      function getHelpMessage() {
        return localStorage["msg"];
      }
      function getCurrentLocation() {
        return window.location.href.toString().split("?");
      }
      function getContent() {
        return document.getElementById("content").innerHTML;
      }
      function setContent(text) {
        document.getElementById("content").innerHTML = text;
      }
      function updateHelp(text) {
        let help = document.getElementById("help");
        help.innerHTML = text;
        setHelpMessage(text);
      }
      function updateUrl(title) {
        let locArray = getCurrentLocation();
        let base = locArray[0];
        let newUrl;
        if (title) {
          newUrl = [base, title].join("?");
        } else {
          newUrl = base;
        }
        window.location.href = newUrl;
        loadFile(title);
      }
      function loadFile(title) {
        let previousAction = action.get();
        action.loadFile();
        let message;
        if (previousAction === "delete") {
          message = getHelpMessage();
        } else if (!title || title === undefined) {
          message = "new file loaded. enter text below.";
        } else if (localStorage[title]) {
          setContent(localStorage[title]);
          message = `'${title}' loaded successfully`;
        } else {
          /* message = `<span style="color: rgb(144, 42, 42);">
              '${title}' not found in local storage
            </span>`; */
          message = errorMessage(`'${title}' not found in local storage`);
          setTimeout(() => updateUrl(""), 1500);
        }
        setHelpMessage(message);
        updateHelp(getHelpMessage());
      }
      function loadFileByUrl() {
        action.loadFileByUrl();
        let title = getCurrentLocation()[1];
        let message;
        if (!title || title === undefined) {
          message = "new file loaded. enter text below.";
        } else if (localStorage[title]) {
          message = `'${title}' loaded successfully`;
          loadFile(title);
        } else {
          /* message = `<span style="color: rgb(144, 42, 42);">
              '${title}' not found in local storage.
            </span>`; */
          message = errorMessage(`'${title}' not found in local storage`);
          setTimeout(() => updateUrl(""), 1500);
        }
        setHelpMessage(message);
        updateHelp(getHelpMessage());
      }
      function loadNewFile() {
        setContent("");
        loadFile();
      }
      function saveToLocalStorage() {
        action.save();
        let title = new Date().getTime();
        let content = document.getElementById("content").innerText.toString();
        let message;
        let url;
        if (!content) {
          url = "";
          /* message = `<span style="color: rgb(144, 42, 42);">
              enter text below before saving.
            </span>`; */
          message = errorMessage(`'${title}' not found in local storage`);
        } else if (content) {
          localStorage.setItem(title, content);
          message = `saved ${title}. reloading file.`;
          url = title;
        }
        const execLoadFile = () => updateUrl(url);
        setTimeout(execLoadFile, 1500);
        setHelpMessage(message);
        updateHelp(getHelpMessage());
      }
      function deleteCurrentFile() {
        action.delete();
        let message;
        if (!getCurrentLocation()[1]) {
          /* message = `<span style="color: rgb(144, 42, 42);">
              no file to delete.
            </span>`; */
          message = errorMessage(`'${title}' not found in local storage`);
        } else {
          localStorage.removeItem(getCurrentLocation()[1]);
          message = `removed: ${getCurrentLocation()[1]}`;
        }
        setHelpMessage(message);
        updateHelp(getHelpMessage());
        const execLoadFile = () => updateUrl("");
        setTimeout(execLoadFile, 1500);
      }
      function clearLocalStorage() {
        action.removeAll();
        Object.keys(localStorage).forEach((item) =>
          localStorage.removeItem(item)
        );
        setContent("");
        let msg = "local storage cleared.";
        setHelpMessage(msg);
        updateHelp(getHelpMessage());
        setTimeout(() => updateUrl(""), 2500);
      }
    </script>
  </body>
</html>
