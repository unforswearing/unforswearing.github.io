<html>
  <head>
    <title>Note</title>
    <style>
      :root {
        --std-size: large;
      }
      html {
        height: 100%;
      }
      body {
        background: rgb(237, 237, 192);
        padding: 0;
        margin: 0;
        font-family: monospace;
        font-size: 20px;
        height: 100%;
      }
      a {
        color: rgb(126, 139, 160);
        font-size: var(--std-size);
      }
      a:visited {
        color: rgb(182, 194, 242);
        font-size: var(--std-size);
      }
      a:hover {
        color: rgb(144, 42, 42);
        font-size: var(--std-size);
      }
      button {
        background: rgb(182, 194, 242);
        width: 100px;
        height: 30px;
        float: left;
        margin-right: 10px;
        font-size: 18px;
        border-radius: 10px;
        border: none;
      }
      .top,
      .bottom {
        width: 840px;
        max-width: 100%;
        margin: auto;
        display: block;
      }
      .top {
        height: 100px;
        padding-top: 20px;
        display: fixed;
      }
      details > summary {
        list-style: none;
      }
      details summary::-webkit-details-marker {
        display: none;
      }
      input,
      input:focus,
      .bottom,
      .bottom:active,
      .bottom:focus {
        min-height: calc(100% - 200px);
        display: block;
        border: 1px solid rgb(126, 139, 160);
      }
      .help {
        color: rgb(126, 139, 160);
        font-size: var(--std-size);
        display: block;
      }
      .showmult {
        display: none;
      }
      .version {
        color: rgb(126, 139, 160);
        font-size: var(--std-size);
        width: 840px;
        max-width: 100%;
        margin: auto;
        display: block;
      }
    </style>
  </head>
  <body onload="execOnLoad();">
    <div class="top">
      <button onclick="loadNewFile()">new</button>
      <button onclick="saveToLocalStorage()">save</button>
      <button onclick="deleteCurrentFile()">delete</button>
      <button class="showmult" id="showmult" onclick="clearLocalStorage()">
        remove all
      </button>
      <br /><br />
      <span class="help" id="help"></span>
      <br />
    </div>
    <div
      id="content"
      class="bottom"
      placeholder="content"
      contenteditable
    ></div>
    <br />
    <div class="version">
      <details>
        <summary style="float: left">0.2.8</summary>
        <span style="float: left; margin-left: 5px">❯❯❯</span
        ><a
          style="float: left; margin-left: 5px"
          href="https://unforswearing.com"
          >unforswearing.com</a
        >
      </details>
    </div>
    <script>
      const action = {
        get() {
          return localStorage["action"];
        },
        load() {
          localStorage.setItem("action", "load");
        },
        new() {
          localStorage.setItem("action", "new");
        },
        save() {
          localStorage.setItem("action", "save");
        },
        delete() {
          localStorage.setItem("action", "delete");
        },
        removeAll() {
          localStorage.setItem("action", "removeAll");
        },
        loadFile() {
          localStorage.setItem("action", "loadFile");
        },
        loadNewFile() {
          localStorage.setItem("action", "loadNewFile");
        },
        loadFileByUrl() {
          localStorage.setItem("action", "loadFileByUrl");
        },
      };
      function messageData(title) {
        function errorMessage(message) {
          return `<span style="color: rgb(144, 42, 42);">
              ${message}
            </span>`;
        }
        const options = {
          error_enter_text() {
            return errorMessage("enter text below before saving.");
          },
          error_no_file_delete() {
            return errorMessage("no file to delete.");
          },
          error_file_not_found(title) {
            return errorMessage(`'${title}' not found in local storage.`);
          },
          startup() {
            return "new file loaded. enter text below.";
          },
          load_success(title) {
            return `'${title}' loaded successfully.`;
          },
          save_success(title) {
            return ` saved '${title}'. reloading file.`;
          },
          delete_success(title) {
            return `removed ${title}.`;
          },
          clear_local_storage_success(title) {
            return `'${title}' not found in local storage.`;
          },
        };
        return options;
      }
      function execOnLoad() {
        loadFileByUrl();
        // storage[1:2] = msg, action;
        if (localStorage.length > 3) {
          document.getElementById("showmult").style.display = "block";
        }
      }
      function setHelpMessage(message) {
        localStorage.setItem("msg", message);
      }
      function getHelpMessage() {
        return localStorage["msg"];
      }
      function getLocation() {
        return window.location.href.toString().split("?");
      }
      function getContent() {
        return document.getElementById("content").innerHTML;
      }
      function setContent(text) {
        document.getElementById("content").innerHTML = text;
      }
      function updateHelp(text) {
        let help = document.getElementById("help");
        help.innerHTML = text;
        setHelpMessage(text);
      }
      function updateUrl(title) {
        let locArray = getLocation();
        let base = locArray[0];
        let newUrl;
        if (title) {
          newUrl = [base, title].join("?");
        } else {
          newUrl = base;
        }
        window.location.href = newUrl;
        loadFile(title);
      }
      function loadFile(title) {
        let previousAction = action.get();
        action.loadFile();
        let message;
        if (previousAction === "delete") {
          message = getHelpMessage();
        } else if (!title || title === undefined) {
          message = messageData().startup();
        } else if (localStorage[title]) {
          setContent(localStorage[title]);
          message = messageData().load_success(title);
        } else {
          message = messageData().error_file_not_found(title);
          setTimeout(() => updateUrl(""), 1500);
        }
        setHelpMessage(message);
        updateHelp(getHelpMessage());
      }
      function loadFileByUrl() {
        action.loadFileByUrl();
        let title = getLocation()[1];
        let message;
        if (!title || title === undefined) {
          message = messageData().startup();
        } else if (localStorage[title]) {
          message = messageData().load_success(title);
          loadFile(title);
        } else {
          message = messageData().error_file_not_found(title);
          setTimeout(() => updateUrl(""), 1500);
        }
        setHelpMessage(message);
        updateHelp(getHelpMessage());
      }
      function loadNewFile() {
        action.loadNewFile();
        setContent("");
        updateUrl("");
      }
      function saveToLocalStorage() {
        action.save();
        let title = new Date().getTime();
        let content = document.getElementById("content").innerText.toString();
        let message;
        let url;
        if (!content) {
          url = "";
          message = messageData().error_enter_text();
        } else if (content) {
          localStorage.setItem(title, content);
          message = messageData().save_success(title);
          url = title;
        }
        const execLoadFile = () => updateUrl(url);
        setTimeout(execLoadFile, 1500);
        setHelpMessage(message);
        updateHelp(getHelpMessage());
      }
      function deleteCurrentFile() {
        action.delete();
        let title = getLocation()[1];
        let message;
        if (!title || !localStorage[title]) {
          message = messageData().error_no_file_delete();
        } else {
          localStorage.removeItem(title);
          message = messageData().delete_success(title);
        }
        setHelpMessage(message);
        updateHelp(getHelpMessage());
        const execLoadFile = () => updateUrl("");
        setTimeout(execLoadFile, 1500);
      }
      function clearLocalStorage() {
        action.removeAll();
        Object.keys(localStorage).forEach((item) =>
          localStorage.removeItem(item)
        );
        setContent("");
        let message = messageData().clear_local_storage_success();
        setHelpMessage(message);
        updateHelp(getHelpMessage());
        setTimeout(() => updateUrl(""), 2500);
      }
    </script>
  </body>
</html>
